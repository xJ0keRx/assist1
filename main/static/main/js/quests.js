const surveyConfig = {
  questions: [
    {
      question: "–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –ª–æ—Ç–µ—Ä–µ—è—Ö?",
      answers: [
        "üî• –†–µ–≥—É–ª—è—Ä–Ω–æ, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é",
        "‚ö° –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏, 1-2 —Ä–∞–∑–∞ –≤ –º–µ—Å—è—Ü",
        "üí´ –†–µ–¥–∫–æ, –æ—Ç —Å–ª—É—á–∞—è –∫ —Å–ª—É—á–∞—é",
        "üéØ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª(–∞)",
      ],
      multiple: false,
    },
    {
      question: "–ö–∞–∫—É—é —Å—É–º–º—É –≤—ã –æ–±—ã—á–Ω–æ –≥–æ—Ç–æ–≤—ã –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –ª–æ—Ç–µ—Ä–µ–π–Ω—ã–π –±–∏–ª–µ—Ç?",
      answers: [
        "üí∞ –î–æ 300 —Ä—É–±–ª–µ–π",
        "üíµ 300-500 —Ä—É–±–ª–µ–π",
        "üíé 500-1000 —Ä—É–±–ª–µ–π",
        "üèÜ –ë–æ–ª–µ–µ 1000 —Ä—É–±–ª–µ–π",
      ],
      multiple: false,
    },
    {
      question: "–ß—Ç–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ –≤ –ª–æ—Ç–µ—Ä–µ–µ?",
      answers: [
        "üéä –†–∞–∑–º–µ—Ä –¥–∂–µ–∫–ø–æ—Ç–∞",
        "üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–∏–≥—Ä—ã—à–∞",
        "‚è∞ –ß–∞—Å—Ç–æ—Ç–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π",
        "üéÅ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑—ã –∏ –∞–∫—Ü–∏–∏",
      ],
      multiple: true,
    },
    {
      question: "–í –∫–∞–∫–∏–µ —Ç–∏–ø—ã –ª–æ—Ç–µ—Ä–µ–π –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –∏–≥—Ä–∞—Ç—å?",
      answers: [
        "üî¢ –ß–∏—Å–ª–æ–≤—ã–µ (–ì–æ—Å–ª–æ—Ç–æ, –†—É—Å—Å–∫–æ–µ –ª–æ—Ç–æ)",
        "‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏",
        "‚öΩ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ (–°–ø–æ—Ä—Ç–ª–æ—Ç–æ)",
        "üé™ –¢–µ–º–∞—á–µ—Å–∫–∏–µ (–ñ–∏–ª–∏—â–Ω–∞—è –ª–æ—Ç–µ—Ä–µ—è)",
      ],
      multiple: true,
    },
    {
      question: "–ö–∞–∫ –≤—ã –æ–±—ã—á–Ω–æ —É–∑–Ω–∞–µ—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ª–æ—Ç–µ—Ä–µ–π?",
      answers: [
        "üåê –ü—Ä–æ–≤–µ—Ä—è—é –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ",
        "üì± –ü–æ–ª—É—á–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏",
        "üì∫ –°–º–æ—Ç—Ä—é —Ç–µ–ª–µ–≤–∏–∑–∏–æ–Ω–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏",
        "üè™ –£–∑–Ω–∞—é –≤ —Ç–æ—á–∫–∞—Ö –ø—Ä–æ–¥–∞–∂",
      ],
      multiple: true,
    },
    {
      question: "–õ—é–±–∏—Ç–µ –ª–∏ –≤—ã —á—Ç–æ –±—ã –æ—Ç –≤–∞—Å —á—Ç–æ-—Ç–æ –∑–∞–≤–∏—Å–µ–ª–æ",
      answers: [
        "üí≠ –î–∞",
        "üéÆ –ë–æ–ª—å—à–µ –¥–∞, —á–µ–º –Ω–µ—Ç",
        "üçÄ –ë–æ–ª—å—à–µ –Ω–µ—Ç, —á–µ–º –¥–∞",
        "üìú –ù–µ—Ç",
      ],
      multiple: false,
    },
    {
      question: "–ì–æ—Ç–æ–≤—ã –ª–∏ –≤—ã –ø–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è?",
      answers: [
        "‚úÖ –î–∞, —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å –ª—É—á—à–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è",
        "‚≠ê –¢–æ–ª—å–∫–æ —Å–∞–º—ã–µ –≤—ã–≥–æ–¥–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã",
        "üéØ –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –≤—ã–±–∏—Ä–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ",
        "‚ùå –ù–µ—Ç, –Ω–µ —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è",
      ],
      multiple: false,
    },
  ],
};

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
let currentQuestionIndex = 0;
let selectedAnswers = [];
let userAnswers = [];

// –≠–ª–µ–º–µ–Ω—Ç—ã DOM
const currentQuestionEl = document.getElementById("currentQuestion");
const answersContainerEl = document.getElementById("answersContainer");
const progressFillEl = document.getElementById("progressFill");
const progressPercentEl = document.getElementById("progressPercent");
const continueBtnEl = document.getElementById("continueBtn");

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ä–æ—Å–Ω–∏–∫–∞
function initSurvey() {
  showQuestion(currentQuestionIndex);
  updateProgress();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
  continueBtnEl.addEventListener("click", goToNextQuestion);

  // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
  document.body.style.opacity = "0";
  document.body.style.transition = "opacity 0.5s ease";

  setTimeout(() => {
    document.body.style.opacity = "1";
  }, 100);
}

// –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
function showQuestion(index) {
  const question = surveyConfig.questions[index];
  selectedAnswers = [];

  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å (—Å—á–µ—Ç—á–∏–∫ –±–æ–ª—å—à–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º)
  currentQuestionEl.textContent = question.question;

  // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
  answersContainerEl.innerHTML = "";
  question.answers.forEach((answer, answerIndex) => {
    const answerEl = document.createElement("div");
    answerEl.className = "answer-option";
    answerEl.innerHTML = `
          <p class="answer-text">${answer}</p>
        `;

    answerEl.addEventListener("click", () =>
      selectAnswer(answerIndex, answerEl, question.multiple)
    );
    answersContainerEl.appendChild(answerEl);
  });

  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
  continueBtnEl.disabled = !question.multiple; // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ —Å—Ä–∞–∑—É
}

// –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞
function selectAnswer(answerIndex, answerEl, isMultiple) {
  if (isMultiple) {
    // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä
    const index = selectedAnswers.indexOf(answerIndex);
    if (index === -1) {
      // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
      selectedAnswers.push(answerIndex);
      answerEl.classList.add("selected");
    } else {
      // –£–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç
      selectedAnswers.splice(index, 1);
      answerEl.classList.remove("selected");
    }

    // –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∞ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞
    continueBtnEl.disabled = false;
  } else {
    // –û–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä
    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–æ–≤
    document.querySelectorAll(".answer-option").forEach((el) => {
      el.classList.remove("selected");
    });

    // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
    answerEl.classList.add("selected");
    selectedAnswers = [answerIndex];

    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
    continueBtnEl.disabled = false;
  }
}

// –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
function goToNextQuestion() {
  if (selectedAnswers.length === 0) return;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
  const currentQuestion = surveyConfig.questions[currentQuestionIndex];
  userAnswers.push({
    questionIndex: currentQuestionIndex,
    answerIndexes: [...selectedAnswers],
    answerTexts: selectedAnswers.map((index) => currentQuestion.answers[index]),
    multiple: currentQuestion.multiple,
  });

  // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ–º
  currentQuestionIndex++;

  if (currentQuestionIndex < surveyConfig.questions.length) {
    showQuestion(currentQuestionIndex);
    updateProgress();
  } else {
    completeSurvey();
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function updateProgress() {
  const progress = (currentQuestionIndex / surveyConfig.questions.length) * 100;
  progressFillEl.style.width = `${progress}%`;
  progressPercentEl.textContent = `${Math.round(progress)}%`;
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞
function completeSurvey() {
  console.log("–û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω! –û—Ç–≤–µ—Ç—ã:", userAnswers);

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
  localStorage.setItem("userLotteryPreferences", JSON.stringify(userAnswers));
  localStorage.setItem("surveyCompleted", "true");

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
  currentQuestionEl.textContent = "üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ø—Ä–æ—Å–∞!";
  answersContainerEl.innerHTML = `
        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
          <p style="font-size: 1.1rem; margin-bottom: 1rem;">–í–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</p>
          <p>–¢–µ–ø–µ—Ä—å –º—ã —Å–º–æ–∂–µ–º –ø–æ–¥–æ–±—Ä–∞—Ç—å –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤.</p>
        </div>
      `;
  progressFillEl.style.width = "100%";
  progressPercentEl.textContent = "100%";
  continueBtnEl.textContent = "–ü–µ—Ä–µ–π—Ç–∏ –∫ –ª–æ—Ç–µ—Ä–µ—è–º";
  continueBtnEl.disabled = false;

  // –ú–µ–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  continueBtnEl.onclick = () => {
    window.location.href = "/"; // –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  };
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener("DOMContentLoaded", initSurvey);
